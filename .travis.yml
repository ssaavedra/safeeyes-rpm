language: generic
sudo: required
env:
  global:
    - VERSION=1.2.2
    - RELEASE=1
  matrix:
  - OS_TYPE=fedora OS_VERSION=26
  # - OS_TYPE=fedora OS_VERSION=25
  # - OS_TYPE=fedora OS_VERSION=24
  # - OS_TYPE=centos OS_VERSION=7
services:
- docker
before_install:
- echo 'DOCKER_OPTS="-H tcp://127.0.0.1:2375 -H unix:///var/run/docker.sock -s devicemapper"'
  | sudo tee /etc/default/docker > /dev/null
- sudo service docker restart
- sleep 5
- sudo docker pull ${OS_TYPE}:${OS_VERSION}
script:
- sudo docker run --rm=true -v `pwd`:/base-src:rw -t ${OS_TYPE}:${OS_VERSION} /bin/bash
  -c /base-src/ci/${OS_TYPE}.sh
- sudo mv python-safeeyes-${VERSION}-${RELEASE}.src.rpm ${OS_TYPE}-${OS_VERSION}-python-safeeyes-${VERSION}-${RELEASE}.src.rpm
- sudo mv x86_64/python3-safeeyes-${VERSION}-${RELEASE}.x86_64.rpm ${OS_TYPE}-${OS_VERSION}-python3-safeeyes-${VERSION}-${RELEASE}.x86_64.rpm
- sudo mv i386/python3-safeeyes-${VERSION}-${RELEASE}.i386.rpm ${OS_TYPE}-${OS_VERSION}-python3-safeeyes-${VERSION}-${RELEASE}.i386.rpm
- sudo chown `id -u`:`id -g` -R .
deploy:
  provider: releases
  skip_cleanup: true
  on:
    tags: true
    repo: ssaavedra/safeeyes-rpm
  api_key:
    secure: Ijw2Vgp1ywjDVYfTe2yEriR7YXndBql+gUmDi8x+gQu8OYStaedvJ0ZNG5Dg1EAMYBIYYfDs9PCBXUIWHkcVGwLNsuooL9tgNiUB33vM1SSTJpAFhM0MUsmeObdnZrvVUeuep1lIx6PS3mSMcb6+WQ9AheMpfwEq4neLM5VBsXxPeIPm1wcqZpyMy5yFXhb6+hKW/hBzsApatHT80Dp1DOeSRtJlAt5C6ghAZ79YFtNAaZwlIctmocZ7gAku8orYiEDm5lyII5cNnOsXoTbL553LEzCNKY5DaJZiyR+Mgx1Fv+RZ2dwuCf/81Uu8XUiCetIP7GC/UKXnWcMv/eSgRM0HemFla1BfP8tOMbnaNNQ2B1XdWoJ8aZPZOQsU9U6JkVShX3k9tXRIGpL1tLBQNYofpMV2LvnEwsdKvrcfEO0795Xci+cP8ssxGFv7Yho1md96+gU6d9fipkVCFIUfWjU6J9UP9jfmojSvN8jwt6s8GR6wBXqn7oK6kJrvF0iEVkH6vEzoEAWyvKTSVvS9VWgGDoSZp3Xbg5tBQtqYyQ2O2jcPWcmIg+ruANWBZbcSLRMXUMGIUB+swF+ijB1QYTxa4fS8IsoEjpXTx2vyWAbDq/7c25cbb/cHdu+oXi8+Svgi9eoVYnv0QrXMd3yP5WiAjAB8SDR0zHb6KuiF4vk=
  file: 
    - ${OS_TYPE}-${OS_VERSION}-python-safeeyes-${VERSION}-${RELEASE}.src.rpm
    - ${OS_TYPE}-${OS_VERSION}-python3-safeeyes-${VERSION}-${RELEASE}.x86_64.rpm
    - ${OS_TYPE}-${OS_VERSION}-python3-safeeyes-${VERSION}-${RELEASE}.i386.rpm
